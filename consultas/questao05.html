<!DOCTYPE html>
<html lang="pt-BR"> 
  <head>
    <meta charset="utf-8">
    <title>Trabalho Js - XML</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
      console.log("oi");

      //Para carregar o arquivo XML em todos os navegadores

      function xmlLoader(url){
        if(window.XMLHttpRequest){
          var Loader = new XMLHttpRequest();
          Loader.open("GET", url ,false);
          Loader.send(null);
          return Loader.responseXML;
        }else if(window.ActiveXObject){
          var Loader = new ActiveXObject("Msxml2.DOMDocument.3.0");
          Loader.async = false;
          Loader.load(url);
          return Loader;
        }
      }

      
      function xmlQueryFilmes(xmlNode,identacao){
          topic_id_sem_hash = "thriller";//var que armazena conteúdo do GET
          var topic_id_com_hash="#"; 
          topic_id_com_hash += topic_id_sem_hash;//var que armazena conteúdo do GET com uma hashtag
          topic_id_filme="";
          var filmes_relacionados = new Array();
          var query=""; //esta var armazenara o conteudo
          var tag_atual=""; //variavel para salvar a tag atual
          var topic_id_atual="";//variavel para salvar o id do filme
          var attr_atual=""; //variavel para salvar o atributo da tag atual
          var link_filme=""; //variavel para salvar o link e não atrapalhar o caminho da arvore
          var numero_de_filmes=0;
          

          if(xmlNode.childNodes[0].nodeType == 1){//ignorar espaços em branco
            //query = query + identacao + xmlNode.childNodes[0].nodeName + ": "
            for(var i=0;i<xmlNode.childNodes[0].childNodes.length;i++){
              tag_atual = xmlNode.childNodes[0].childNodes[i].nodeName
              if(tag_atual=="topic"){
                topic_id_atual = xmlNode.childNodes[0].childNodes[i].attributes[0].value;
                if(xmlNode.childNodes[0].childNodes[i].childNodes[1].childNodes[1].nodeName=="topicRef"){
                  attr_atual = xmlNode.childNodes[0].childNodes[i].childNodes[1].childNodes[1].attributes[0].value
                  if(attr_atual=="#Filme"){
                    if(xmlNode.childNodes[0].childNodes[i].childNodes.length>10){
                      //Bloco de código para pegar o elenco apoio
                      var j=11;//Var para indicar o caminho, começa no 11 pois é o inicial padrão para começar a mostrar o elenco apoio
                        if(j==xmlNode.childNodes[0].childNodes[i].childNodes.length){
                          continue;
                        }else{
                          var contador_elenco_apoio=0;
                          while(xmlNode.childNodes[0].childNodes[i].childNodes[j].childNodes[1].childNodes[1].attributes[0].value=="#elencoApoio"){
                            contador_elenco_apoio++;
                            if(contador_elenco_apoio==4){
                              numero_de_filmes++;
                            }
                            if(j+2==xmlNode.childNodes[0].childNodes[i].childNodes.length){
                              if(topic_id_sem_hash=="a-lista-de-schindler" || topic_id_sem_hash=="conan-o-barbaro" ||
                                topic_id_sem_hash=="conan-o-destruidor"){
                                j+=2;
                              }
                              break;
                            }
                            j+=2;
                          }
                    }
                  }
                }
              }
            }
          }
          }
        return numero_de_filmes;
      }


        xml = xmlLoader("../xml.xml"); //carrega o xml
        document.write("<center><h1>Pergunta:</h1>");
        document.write("<h3>e) Quantos filmes contém mais de 3 atores como elenco de apoio?</h3>");
        document.write("<h1>Resposta da query</h1>");
        document.write("<h3>O número de filmes com mais de 3 pessoas no elenco apoio é: "+xmlQueryFilmes(xml,"<br>")+"</h3>"); //printa a query na tela
        document.write("<br><a href='questao04.html'><h3>Questão Anterior <-</a>     ");
        document.write("<a href='questao06.html'>Próxima Questão -></h3></a><br>");
    </script>
  </head>
  <body>
      <!-- Trabalho feito por Gabriel Di Domenico e Rene  -->
  </body>
</html>